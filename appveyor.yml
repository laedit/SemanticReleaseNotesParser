
cache:
- src/packages -> **\packages.config
- C:\ProgramData\chocolatey\bin -> build.fsx
- C:\ProgramData\chocolatey\lib -> build.fsx
- tools -> build.fsx

init:
  - git config --global core.autocrlf true
  
install:
- GitVersion /UpdateAssemblyInfo true

build_script:
  build.bat

test: off

artifacts:
- path: build\static-analysis.Core.sarif.json
- path: build\static-analysis.Program.sarif.json

- path: artifacts\coverage.xml

- path: artifacts\SemanticReleaseNotesParser.exe
  name: SemanticReleaseNotesParser.exe

- path: artifacts\ReleaseNotes.html
  name: ReleaseNotes.html

- path: artifacts\semanticreleasenotes-parser.*.nupkg
  name: SemanticReleaseNotesParser.nupkg

- path: artifacts\SemanticReleaseNotesParser.Core.*.nupkg
  name: SemanticReleaseNotesParser.Core.nupkg

- path: artifacts\SemanticReleaseNotesParser.Fake.*.nupkg
  name: SemanticReleaseNotesParser.Fake.nupkg

- path: artifacts\SemanticReleaseNotesParser.*.zip
  name: SemanticReleaseNotesParser.zip
  
- path: artifacts\SemanticReleaseNotesParserHelper.fsx
  name: SemanticReleaseNotesParserHelper.fsx

deploy:
  - provider: GitHub
    auth_token:
      secure: WaNF2IUzat+PQQqquLoaN43QIpnUsrYgSOGN3P5Tpy+A+ANOWQqvWE0eFA+XwmmX
    artifact: SemanticReleaseNotesParser.zip, SemanticReleaseNotesParserHelper.fsx
    description: $(SemanticReleaseNotes)
    on:
      appveyor_repo_tag: true

  - provider: NuGet
    server: https://chocolatey.org/
    api_key:
      secure: 2GBJF71EQfU+kIL5NHVM4wYoCRcFf/gM/voNIgud8vDWUE+uA1ye/hRWjJPQWA5w
    skip_symbols: true
    artifact: SemanticReleaseNotesParser.nupkg
    on:
      appveyor_repo_tag: true

  - provider: NuGet
    api_key:
      secure: NmM24h0TPsfINvy/1Qr4iJkmRjVztuY5umCJ6mzpxSjvuKl48AXjGEcgow+iJwL8
    artifact: SemanticReleaseNotesParser.Core.nupkg, SemanticReleaseNotesParser.Fake.nupkg
    on:
      appveyor_repo_tag: true
